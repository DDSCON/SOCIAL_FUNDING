<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="a2team.yang.jae.account.mybatis.AccountMapper">

	<select id="getAllMember" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT seq
		FROM member

		WHERE email = #{email}
	
	</select>
	
		<select id="getPayInfo" resultType="java.util.HashMap"	parameterType="java.util.HashMap">
		SELECT * 
		FROM member_payinfo 
		LEFT JOIN member on member_payinfo.m_seq = member.seq
		<if test="email != null">
			WHERE member.email = #{email}
		</if>
	</select>
	
	
	<update id="updataMember_detail" parameterType="java.util.HashMap">
		UPDATE member_detail SET 
		addr = #{addr}
		,addr_detail = #{addr_detail}
		,sns= #{sns}
		,phone= #{phone} 
		WHERE m_seq = #{seq}
	</update>
	
	<update id="updata_card_payinfo" parameterType="java.util.HashMap">
		UPDATE member_payinfo SET 
		card_company = #{card_company}
		,card_company_code = #{card_company_code}
		,card_number= #{card_number}
		,card_expire_month= #{card_expire_month} 
		,card_expire_year= #{card_expire_year} 
		WHERE m_seq = #{seq}
	</update>
	
	
		<select id="getMemberDetail" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT *
		FROM member_detail
		LEFT JOIN member on member_detail.m_seq = member.seq
		<if test="email != null">
			WHERE email = #{email}
		</if>
	
	</select>
	
	
	
	<select id="getProjectView" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT *, format(funded, 0) AS funded_money, format(f_goal, 0) AS f_goal_money, datediff(f_duration, dateNow) as d_day
		FROM myproject_view
		<if test="null != m_seq">
	    WHERE m_seq = #{m_seq}
	    </if>
	</select>
	
	
	<select id="getContributer" parameterType="java.util.HashMap" resultType="java.util.HashMap">
				SELECT 
	
		payment.m_seq
		,payment.p_seq
		,option_no
		,pay_money
		,card_company
		,card_company_code
		,cardnumber
		,cardexpiremonth
		,cardexpireyear
		,name
		,email
			
		,addr
		,addr_detail				

    	,o_description0
    	,o_description1
    	,o_description2
    	,o_description3
    	,o_description4
    
    	, DATE_FORMAT(pay_date, '%Y-%m-%d') AS pay_date
		
		FROM payment
		LEFT JOIN member on payment.m_seq = member.seq
		LEFT JOIN member_detail on payment.m_seq = member_detail.m_seq
    	LEFT JOIN project_option on payment.p_seq = project_option.p_seq

		<if test="null != p_seq">
	    WHERE payment.p_seq = #{p_seq}
	    </if>
	     ORDER BY payment.pay_money desc, payment.option_no desc
	 
	</select>
	
	
	
	<!-- <select id="getPayInfo" resultType="java.util.HashMap"	parameterType="java.util.HashMap">
		SELECT * 
		FROM member_payinfo 
		LEFT JOIN member on member_payinfo.m_seq = member.seq
		<if test="email != null">
			WHERE member.email = #{email}
		</if>
	</select>


	<select id="getAllMember" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT seq
		, name
		, id
		, password
		, phone
		FROM member
		<if test="null != seq">
			WHERE seq = #{seq}
		</if>
	</select>

	<insert id="insertPayment" parameterType="java.util.HashMap">
		INSERT INTO payment (
		m_seq
		,p_seq
		,option_no
		,pay_money
		,card_company
		,card_company_code
		,cardnumber
		,cardexpiremonth
		,cardexpireyear
		
		) VALUES (
		#{m_seq}
		,#{p_seq}
		,#{option_no}
		,#{pay_money}
		,#{card_company}
		,#{card_company_code}
		,#{cardnumber}
		,#{cardexpiremonth}
		,#{cardexpireyear}
		
		)
	</insert>

	<update id="updateMember" parameterType="java.util.HashMap">
		UPDATE member SET
		name = #{name}
		,id = #{id}
		,password = #{password}
		,phone = #{phone}
		WHERE seq = #{seq}
	</update>

	<delete id="deleteMember" parameterType="java.util.HashMap">
		DELETE FROM member
		WHERE
		seq = #{seq}
	</delete>

	<select id="login" parameterType="java.util.HashMap" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM member
		WHERE email = #{email}
		AND pw = #{pw}
	</select>

	<insert id="signup" parameterType="java.util.HashMap">
		INSERT INTO member(
		name
		,email
		,pw
		)VALUES (
		#{name}
		,#{email}
		,#{pw}
		)
	</insert> -->


</mapper>