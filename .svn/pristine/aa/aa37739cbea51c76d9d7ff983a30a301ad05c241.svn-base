<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<c:if test="${ !empty comments}">
	<c:forEach var="comments" items="${comments}" varStatus="status">
<script type="text/javascript">

	function showCommentTA(idx){
		$('.up_comment').filter(function(index){
			return index == idx;
		}).toggle();
	}
	
	function delComment(d_seq) {
		if (confirm("삭제하시겠습니까?") == false) {
			return false;
		}
		$.ajax({
			type : "POST",
			url : "/deleteComment",
			data : {
				d_seq : d_seq,
				p_seq :<%=request.getParameter("seq")%>
				,seq :<%=request.getParameter("seq")%>
	},
			dataType : "html"
		}).done(function(returnData) {
			alert("삭제되었습니다.");
			$("#commentList").html(returnData);

		});
	}
	
	
	
	function upComment(d_seq,idx) {
		alert($('.u_comment').filter(function(index){
			return index == idx;
		}).val());
		if (confirm("수정하시겠습니까?") == false)
			return false;
		$.ajax({
			type : "POST",
			url : "/updateComment",
			data : {
				d_seq : d_seq,
				update_comment : $('.u_comment').filter(function(index){
					return index == idx;
				}).val()
				,seq : <%=request.getParameter("seq")%>
	},
			dataType : "html"
		}).done(function(msg) {
			$("#commentList").html(msg);

		});
	}

</script>

		<form class="showcomment">
		<div class="[ b-media b-media--valign_top ] ui-comment " data-channel="16661">
		<div class="b-media__item">
		<div class="b-avatar" style="width: 64px" >
		<div class="b-avatar__frame" style="width:64px; height:64px">
		<img alt="Avatar_9_medium" class="b-avatar__pic" src="/resources/images/profile.JPG" />
		</div>  
		</div>
		</div> 
		
		<div class="b-media__body"> 
		<div class="b-meta">
		<span class="b-meta__title yoke"><c:out value="${comments.m_name}"></c:out></span>  
		<span class="b-meta__item text-size_3xs">
		<c:out value="${comments.reg_date}"></c:out></span>
		
		<c:if test="${ comments.m_name eq sessionScope.name}">
			<span class="up_del" >
				<a href="javascript:showCommentTA('${status.index}')">수정</a>	
				<a href="javascript:delComment('${comments.d_seq}')">삭제</a>
			</span> 
		</c:if>
		
		<div class="up_comment" style="display:none">
		<textarea  class="[ form-field ] ui-textarea js-textarea-for-new-channel u_comment"  wrap="hard" name="u_comment" id="u_comment" placeholder="댓글을 남겨주세요" rows="3"/></textarea>
		<a href="javascript:upComment('${comments.d_seq}','${status.index}')" class="b-button js-submit-new-channel" id="zbutton">수정</a>
		</div>
      <div class="text-size_xs">
       <pre> <p><c:out value="${comments.update_comment}"></c:out></p></pre>
      </div> 

      	<br>
      
	</div>
    </div>
  </div>
		</form>
  	</c:forEach>
</c:if> 
